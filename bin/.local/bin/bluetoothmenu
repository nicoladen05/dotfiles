#!/bin/bash

backend="bluetoothctl"

devices=" Devices"


power_on() {
    if bluetoothctl show | grep -F -q "Powered: yes"; then
        return 0
    else
        return 1
    fi
}

if power_on; then
    toggle=" Turn off controller"
else
    toggle=" Turn on controller"
fi

#check whether bluetoothctl is installed and is working correctly
is_bluetoothctl_installed_correctly() {
	if [[ $($backend -v) == bluetoothctl* &&
	$($backend power on) == "Changing power on succeeded" &&
	$($backend list) == Controller* ]]; then
		echo $backend 'is installed and configured correctly'
	fi
}

get_already_paired_devices() {
	IFS=
	echo $($backend paired-devices);
}

connect_device() {
	$backend connect $2;
}


options="$toggle\n$devices"

chosen="$(echo -e "$options" | dmenu)"


case $chosen in
    "$toggle") 
				if power_on; then
						$backend power off
				else
						$backend power on
				fi
		;;
    "$devices")
				connect_device $(get_already_paired_devices | dmenu);
esac
